<!--/sorting_array-->

{% extends "base.html" %}

{% block content %}

<div class="max-w-screen-2xl"> <!-- mx-auto -->
    <div class="flex flex-col">
        <div class="flex flex-col items-center">
            <h1 class="mb-4 text-3xl font-extrabold leading-none tracking-tight text-gray-900 md:text-4xl lg:text-5xl dark:text-white">Сортировка массива</h1>
        </div>
    </div>
        <div class="flex">
            <div class="w-1/2 flex flex-col h-screen">
               <div class="flex-shrink-0 h-40px">
                    <div class="flex flex-row h-6">
                        <label for="inputArray">
                            <h1 id="inputArrayLabel" class="font-extrabold leading-none tracking-tight text-gray-900  underline-offset-8 dark:text-white">Введите массив</h1>
                        </label>
                        <div id="arrayButtonContainer">
                            <div class="inline-flex ml-2" role="group" aria-label="Button group">
                                <button id="addButton" onclick="addCell()" class="h-6 px-5 text-sm font-medium  text-blue-700 transition-colors duration-150 bg-sky-50 rounded-l-lg focus:shadow-outline hover:bg-sky-800 hover:text-white">Добавить</button>
                                <button id="deleteButton" onclick="removeCell()" class="h-6 px-5 text-sm font-medium  text-blue-700 transition-colors duration-150 bg-rose-100 rounded-r-lg focus:shadow-outline hover:bg-pink-900 hover:text-white">Удалить</button>
                            </div>                        
                        </div>
                    </div>
                    
                    <div id="inputArray" class="flex mb-1 ml-1 mb-4 space-x-1" style="white-space: nowrap; overflow-x: auto;">
                        <div id="cell-1" class="p-4 w-12 h-10 relative flex-shrink-0">
                            <input type="number" class="absolute inset-0 w-full h-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" value="" required>
                        </div>
                    </div>
                </div> 
                <div class="mb-5">
                    <div id="treeVisualization" class="border border 1"></div>
                </div>
            </div>
            
            <div class="w-1/2 flex flex-col h-screen">
                <div id="firstArrayContainer" class="flex-shrink-0 h-40px ml-2" style="display:none">
                     <div class="flex flex-row h-6">
                         <label for="firstArray">
                             <h1 id="firstArrayLabel" class=" font-extrabold leading-none tracking-tight text-gray-900  underline-offset-8 dark:text-white">Отсортированный массив1</h1>
                         </label>
                     </div>
                     
                     <div id="firstArray" class="flex mb-1 ml-1 mb-4 space-x-1" style="white-space: nowrap; overflow-x: auto;">
                         <!-- <div id="cell-1" class="p-4 w-12 h-10 relative flex-shrink-0">
                             <input type="number" class="absolute inset-0 w-full h-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="0" required>
                         </div> -->
                     </div>
                 </div> 
                 <div id="secondArrayContainer" class="flex-shrink-0 h-40px ml-2 flex-none" style="display:none">
                    <div class="flex flex-row h-6">
                        <label for="secondArray">
                            <h1 id="secondArrayLabel" class=" font-extrabold leading-none tracking-tight text-gray-900  underline-offset-8 dark:text-white">Отсортированный массив2</h1>
                        </label>
                    </div>
                    
                    <div id="secondArray" class="flex mb-1 ml-1 mb-4 space-x-1" style="white-space: nowrap; overflow-x: auto;">
                        <!-- <div id="cell-1" class="p-4 w-12 h-10 relative flex-shrink-0">
                            <input type="number" class="absolute inset-0 w-full h-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="0" required>
                        </div> -->
                    </div>
                </div> 

                <div id="buttonsContainer" class="flex flex-col w-full h-full justify-center items-center ">
                    <div >
                       <button onclick="searchTreeSort(event)" id="buttonSearchTreeSort" type="button" class="mb-8 w-64 text-blue-700 hover:text-white border border-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2 dark:border-blue-500 dark:text-blue-500 dark:hover:text-white dark:hover:bg-blue-500 dark:focus:ring-blue-800 ">Сортировка деревом поиска</button>
                   </div>
                   <div >
                       <button onclick="tournamentSort(event)" id="buttonTournamentSort" type="button" class="mb-8 w-64 text-blue-700 hover:text-white border border-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2 dark:border-blue-500 dark:text-blue-500 dark:hover:text-white dark:hover:bg-blue-500 dark:focus:ring-blue-800">Посмотреть пример</button>
                   </div>
                   
               </div>

               <div id="returnButtonContainer" class="ml-2" style="display:none">
                    <button onclick="returnButton()" type="button" class=" mb-5 w-56 flex items-center justify-center w-56 px-5 py-2 text-sm text-gray-700 transition-colors duration-200 bg-white border rounded-lg gap-x-2 sm:w-auto dark:hover:bg-gray-800 dark:bg-gray-900 hover:bg-gray-100 dark:text-gray-200 dark:border-gray-700">
                        <svg class="w-5 h-5 rtl:rotate-180" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 15.75L3 12m0 0l3.75-3.75M3 12h18" />
                        </svg>
                        <span>Назад</span>
                    </button>
               </div>

               <div id="stepTextArea" class="flex flex-col w-full h-1/3 justify-end items-center" style="display:none">
                    <div class="relative h-20">

                    <textarea id="stepDescription"
                      class="peer  h-full w-80 resize-none rounded-[7px] text-center border border-blue-gray-200 border-t-transparent bg-transparent px-3 py-2.5 font-sans text-sm font-normal text-blue-gray-700 outline outline-0 transition-all placeholder-shown:border placeholder-shown:border-blue-gray-200 placeholder-shown:border-t-blue-gray-200 focus:border-2 focus:border-purple-500 focus:border-t-transparent focus:outline-0 disabled:resize-none disabled:border-0 disabled:bg-blue-gray-50"
                      placeholder=" " readonly></textarea>
                    <label id="stepCounterLabel"
                      class="before:content[' '] after:content[' '] pointer-events-none absolute left-0 -top-1.5 flex h-full w-full select-none text-[15px] font-bold leading-tight text-blue-gray-400 transition-all before:pointer-events-none before:mt-[6.5px] before:mr-1 before:box-border before:block before:h-1.5 before:w-2.5 before:rounded-tl-md before:border-t before:border-l before:border-blue-gray-200 before:transition-all after:pointer-events-none after:mt-[6.5px] after:ml-1 after:box-border after:block after:h-1.5 after:w-2.5 after:flex-grow after:rounded-tr-md after:border-t after:border-r after:border-blue-gray-200 after:transition-all peer-placeholder-shown:text-sm peer-placeholder-shown:leading-[3.75] peer-placeholder-shown:text-blue-gray-500 peer-placeholder-shown:before:border-transparent peer-placeholder-shown:after:border-transparent peer-focus:text-[11px] peer-focus:leading-tight peer-focus:text-purple-500 peer-focus:before:border-t-2 peer-focus:before:border-l-2 peer-focus:before:border-purple-500 peer-focus:after:border-t-2 peer-focus:after:border-r-2 peer-focus:after:border-purple-500 peer-disabled:text-transparent peer-disabled:before:border-transparent peer-disabled:after:border-transparent peer-disabled:peer-placeholder-shown:text-blue-gray-500">
                    
                    </label>
                    </div>
                    
               </div>

               <div id="prevNextButtonsContainer" class="flex flex-col w-full h-1/5 justify-start items-start" style="display:none">
                        <div class=" max-w-lg p-10 container flex justify-center mx-auto">
                                            <div class="flex flex-row mx-auto">
                                            <button id="prevStepButton" type="button" class="bg-[#ede9fe] text-[#2e1065] rounded-l-md border-r border-gray-100 py-2 hover:bg-[#3b0764] hover:text-white px-3">
                                                <div class="flex flex-row align-middle">
                                                <svg class="w-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                    <path fill-rule="evenodd" d="M7.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd"></path>
                                                </svg>
                                                <p class="ml-2">Предыдущий шаг</p>
                                                </div>
                                            </button>
                                            <button id="nextStepButton" type="button" class="bg-[#ede9fe] text-[#2e1065] rounded-r-md py-2 border-l border-gray-200 hover:bg-[#3b0764] hover:text-white px-3">
                                                <div class="flex flex-row align-middle">
                                                <span class="mr-2">Следующий шаг</span>
                                                <svg class="w-5 ml-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                    <path fill-rule="evenodd" d="M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                                </svg>
                                                </div>
                                            </button>
                                            </div>
                                        </div>
               </div>
               
            </div>
        </div>

            
                    
            
                
        </div>
        
</div>

<script> 
    var firstArrayContainer=document.getElementById('firstArrayContainer');
    var secondArrayContainer=document.getElementById('secondArrayContainer');
    var buttonsContainer=document.getElementById('buttonsContainer');
    var arrayButtonContainer=document.getElementById('arrayButtonContainer');
    var returnButtonContainer=document.getElementById('returnButtonContainer');
    var inputArrayLabel=document.getElementById('inputArrayLabel');
    var firstArrayLabel=document.getElementById('firstArrayLabel');
    var secondArrayLabel=document.getElementById('secondArrayLabel');
    var prevNextButtonsContainer=document.getElementById('prevNextButtonsContainer')
    var stepTextArea=document.getElementById('stepTextArea');
    var stepDescription=document.getElementById('stepDescription');
    var stepCounterLabel=document.getElementById('stepCounterLabel');


    var container = document.getElementById('treeVisualization');
        var data = {
            nodes: new vis.DataSet([]),
            edges: new vis.DataSet([])
        };

        //buildTree(serializedTree, data.nodes, data.edges, 1);

        var options = {
            width: '100%',
            height: '450px',
            physics: false,
            nodes: {
                //size:4000,
                font: {
                  size: 50
                },
                color: {
                    background: 'rgba(140, 255, 220, 1)',  // Прозрачный цвет фона
                    highlight:  'rgba(140, 255, 220, 1)',
                    //hover: 'rgba(0,0,0,0)'
                    },
                    font: {
                        color: 'rgba(0, 0, 0, 1)'  // Прозрачный цвет текста
                    },
                    borderWidth: 1 , // Устанавливаем толщину обводки в 0, чтобы сделать ее прозрачной
                    
              
                },
              edges: {
                color: 'rgba(0, 0, 0, 0.5)',  // Прозрачный цвет ребра
                //highlight: 'rgba(0, 0, 0, 1)',
                font: {
                  align: "top"
                },
                arrows: {
                    arrowStrikethrough:false,
                  to: { enabled: true, scaleFactor: 1, type: "arrow" }
                }
              },
              layout: {
                hierarchical: {
                  direction: "UD",
                  sortMethod: 'directed',
                  nodeSpacing: 50,
                  shakeTowards: 'roots',
                  levelSeparation:70,

                }
              },
              interaction: {
                tooltipDelay: 200,
                hover: true,
                navigationButtons: true,
                keyboard: true
              },
              
        };

        
        
        
        var network = new vis.Network(container, data, options);

        //let cellCounter = 1; // Инициализация счетчика

        function addCell() {
            var inputArray = document.getElementById('inputArray');
            var newCell = document.createElement('div');
            var cellId = 'cell-' + cellCounter; // Формирование уникального идентификатора
        
            newCell.id = cellId; // Присвоение уникального идентификатора
            newCell.className ="p-4 w-12 h-10 relative flex-shrink-0"; // Установите размер ячейки
        
            var inputElement = document.createElement('input');
            inputElement.type = 'number';
            inputElement.className = "absolute inset-0 w-full h-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500";
            inputElement.placeholder = '0'; // Установите значение по умолчанию
            inputElement.required=true;
            newCell.appendChild(inputElement);
        
            inputArray.appendChild(newCell);
        
            cellCounter++; // Увеличение счетчика для следующей ячейки
          }

        function searchTreeSort(event) {
           
            firstArrayContainer.style.display='';
            buttonsContainer.style.display='none';
            arrayButtonContainer.style.display='none';
            returnButtonContainer.style.display='';
            inputArrayLabel.textContent="Исходный массив";
            firstArrayLabel.textContent="Отсортированный массив";
            prevNextButtonsContainer.style.display='';
            stepTextArea.style.display='';
            displayFirstArray();
            saveArrayAndFetchSteps(event);
        }

        function tournamentSort() {

            firstArrayContainer.style.display='';
            secondArrayContainer.style.display='';
            console.log("до");
            buttonsContainer.style.display='none';
            console.log("после");
            arrayButtonContainer.style.display='none';
            returnButtonContainer.style.display='';
            inputArrayLabel.textContent="Исходный массив";
            firstArrayLabel.textContent="Массив победителей";
            secondArrayLabel.textContent="Массив проигравших";
            prevNextButtonsContainer.style.display='';
            stepTextArea.style.display='';
            displayFirstArray();
            displaySecondArray();
            saveArrayAndFetchSteps(event);
        }

        function returnButton() {
            firstArrayContainer.style.display='none';
            secondArrayContainer.style.display='none';
            arrayButtonContainer.style.display='';
            returnButtonContainer.style.display='none';
            buttonsContainer.style.display='';
            inputArrayLabel.textContent="Введите массив"
            prevNextButtonsContainer.style.display='none';
            stepTextArea.style.display='none';

            data.nodes.clear();
            data.edges.clear();
        }

        

        function removeCell() {
            var inputArray = document.getElementById('inputArray');
            
            // Проверка наличия более одной ячейки
            if (inputArray.children.length > 1) {
              var lastCell = inputArray.lastChild;
              inputArray.removeChild(lastCell);
              
              cellCounter--;
            }
          }

          document.getElementById('prevStepButton').addEventListener('click', function() {
            console.log("Нажали на кнопку предыдущего шага")
            console.log("currentStepIndex=",currentStepIndex);
            if (currentStepIndex > 0) {
              
        
              currentStepIndex--;
              printCurrentStep();
            }
            //updateButtons();
          });
        
          document.getElementById('nextStepButton').addEventListener('click', function() {
            console.log("Нажали на кнопку следующего шага")
            console.log("currentStepIndex=",currentStepIndex);
            if (currentStepIndex < steps.length - 1) {
              currentStepIndex++;
              console.log("11111111")
              printCurrentStep();
            }
            //updateButtons();
          });
</script>
{% endblock %}